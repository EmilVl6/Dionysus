<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Developer ≷ Drummer | If you don’t know who I am, then maybe your best course would be to Tread Lightly" />
  <title>Emil Vinod</title>
  <link rel="icon" href="favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;800&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@700&display=swap" rel="stylesheet">
  <script src="phraseology.js"></script>
</head>

<body>
  <div class="pixel-grid" aria-hidden="true"></div>
  <div id="page-wrap">
    <button id="color-btn" title="" aria-label="">
      <img src="favicon.png" alt="icon" class="color-btn-icon" />
    </button>
    <main class="center">
    <div class="scene" aria-hidden="true">
      <div class="banner">
        <div class="panel" data-index="1" data-text=""></div>
        <div class="panel" data-index="2" data-text=""></div>
        <div class="panel" data-index="3" data-text=""></div>
        <div class="panel" data-index="4" data-text=""></div>
        <div class="panel" data-index="5" data-text=""></div>
        <div class="panel" data-index="6" data-text=""></div>
        <div class="panel" data-index="7" data-text=""></div>
        <div class="panel" data-index="8" data-text=""></div>
        <div class="panel" data-index="9" data-text=""></div>
        <div class="panel" data-index="10" data-text=""></div>
        <div class="panel" data-index="11" data-text=""></div>
        <div class="panel" data-index="12" data-text=""></div>
        <div class="panel" data-index="13" data-text=""></div>
        <div class="panel" data-index="14" data-text=""></div>
        <div class="panel" data-index="15" data-text=""></div>
        <div class="panel" data-index="16" data-text=""></div>
        <div class="panel" data-index="17" data-text=""></div>
        <div class="panel" data-index="18" data-text=""></div>
        <div class="panel" data-index="19" data-text=""></div>
        <div class="panel" data-index="20" data-text=""></div>
        <div class="panel" data-index="21" data-text=""></div>
        <div class="panel" data-index="22" data-text=""></div>
        <div class="panel" data-index="23" data-text=""></div>
        <div class="panel" data-index="24" data-text=""></div>
      </div>
      <div class="screen"></div>
    </div>
      <div class="portrait" aria-hidden="true"><img src="Me.png" alt="" /></div>
      <div class="center-inner">
      <div class="pencil-intro">Hi I'm</div>
      </div>
      <h1 class="emil">Emil</h1>
      <h1 class="vinod">Vinod</h1>
      <p class="subtitle">Developer ≷ Drummer</p>
    </main>
  </div>
  <script>
    (function(){
      const colors = [
        '#ff6b35', '#bf7d5a', '#d55151', '#4e9294', '#c47085', '#ccb096', '#ca6d5c', '#aaa565'
      ];
      let idx = 0;
      const btn = document.getElementById('color-btn');
      const root = document.documentElement;
      function setBg(i){
        idx = i;
        root.style.setProperty('--bg', colors[idx]);
        btn.style.background = colors[(idx+1)%colors.length];
        btn.style.boxShadow = '0 2px 8px rgba(0,0,0,0.08)';
      }
      btn.addEventListener('click', function(){
        setBg((idx+1)%colors.length);
      });
      setBg(0);
    })();
    (function(){
      const el = document.querySelector('.center');
      if(!el) return;
      const inner = el.querySelector('.center-inner');
      if(!inner) return;
      el.style.overflow = 'hidden';
      function fit(){
        inner.style.transform = '';
        const neededH = inner.scrollHeight || inner.getBoundingClientRect().height || 0;
        const neededW = inner.scrollWidth  || inner.getBoundingClientRect().width  || 0;
        const availH = window.innerHeight || 0;
        const availW = window.innerWidth  || 0;
        const scaleH = neededH ? (availH / neededH) : 1;
        const scaleW = neededW ? (availW / neededW) : 1;
        const scale = Math.min(1, scaleH, scaleW);
        inner.style.transformOrigin = 'center center';
        inner.style.transform = `scale(${scale})`;
      }
      window.addEventListener('resize', fit);
      window.addEventListener('load', () => setTimeout(fit, 50));
      setTimeout(fit, 50);
      if (document.fonts && document.fonts.ready && typeof document.fonts.ready.then === 'function') {
        document.fonts.ready.then(fit);
      }

      (function(){
        const words = window.bgHeroWords || [];

        const phrases = words.map(s => String(s).trim());

        let phraseQueue = [];
        function shuffleQueue(){
          phraseQueue = phrases.slice();
          for(let i=phraseQueue.length-1;i>0;i--){
            const j = Math.floor(Math.random()*(i+1));
            [phraseQueue[i],phraseQueue[j]] = [phraseQueue[j],phraseQueue[i]];
          }
        }
        shuffleQueue();
        let queueIndex = 0;

        function pickNextPhrase(){
          if(phraseQueue.length === 0) shuffleQueue();
          if(queueIndex >= phraseQueue.length){
            shuffleQueue();
            queueIndex = 0;
          }
          return phraseQueue[queueIndex++];
        }

        const displayDelay = 4500;
        const fadeDuration = 450;
        const eraseDelay = 350;

        let typingTimers = [];
        function clearTimers(){ for(const t of typingTimers) clearTimeout(t); typingTimers = []; }

        function typeWord(word){
          clearTimers();
          const banner = document.querySelector('.banner');
          banner.dataset.lockAngle = '0';
          banner.style.animation = 'none';
          banner.style.transform = 'rotateY(0deg)';
          banner.offsetHeight; 
          banner.style.animation = 'rotate 24s infinite linear';
          document.querySelectorAll('.panel').forEach(p => p.setAttribute('data-text', ''));

          const typeSpeed = 60;
          const preCharDelay = 100;
          for(let i=0;i<word.length;i++){
            typingTimers.push(setTimeout(()=>{
              const text = word.slice(0, i) + '_';
              document.querySelectorAll('.panel').forEach(p => p.setAttribute('data-text', text));
            }, i * typeSpeed));

            typingTimers.push(setTimeout(()=>{
              const text = word.slice(0, i + 1);
              document.querySelectorAll('.panel').forEach(p => p.setAttribute('data-text', text));
            }, i * typeSpeed + preCharDelay));
          }

          typingTimers.push(setTimeout(() => {
            document.querySelectorAll('.panel').forEach(p => p.setAttribute('data-text', word));
          }, word.length * typeSpeed + preCharDelay));

          const total = word.length * typeSpeed + displayDelay;
          typingTimers.push(setTimeout(()=>{
            delete banner.dataset.lockAngle;
            typingTimers.push(setTimeout(()=>{ typeWord(pickNextPhrase()); }, eraseDelay));
          }, total));
        }

      setTimeout(()=>{ typeWord(pickNextPhrase()); }, 300);
      })();
    })();
  </script>
  <script>
    (function(){
      const cursor = document.createElement('div');
      cursor.className = 'cursor-circle';
      cursor.style.left = '-9999px';
      cursor.style.top = '-9999px';
      cursor.style.opacity = '0';
      document.body.appendChild(cursor);

      let mouseX = window.innerWidth/2, mouseY = window.innerHeight/2;
      let raf = null;
      let _seenFirstMove = false;

      function render(){
        cursor.style.left = mouseX + 'px';
        cursor.style.top = mouseY + 'px';
        raf = null;
      }

      window.addEventListener('mousemove', (e)=>{
        mouseX = e.clientX; mouseY = e.clientY;
        if(!_seenFirstMove){
          _seenFirstMove = true;
          cursor.style.opacity = '1';
        }
        
        if(!raf) raf = requestAnimationFrame(render);
      }, {passive:true});

        document.addEventListener('mouseleave', ()=>{
          cursor.style.opacity = '0';
        });
        document.addEventListener('mouseenter', ()=>{
          if(_seenFirstMove) cursor.style.opacity = '1';
        });

      window.addEventListener('mousedown', ()=>{ cursor.classList.add('active'); });
      window.addEventListener('mouseup', ()=>{ cursor.classList.remove('active'); });

      function bindHoverBig(selector){
        document.querySelectorAll(selector).forEach(el=>{
          el.addEventListener('mouseenter', ()=> cursor.classList.add('big'));
          el.addEventListener('mouseleave', ()=> cursor.classList.remove('big'));
        });
      }
      bindHoverBig('a');
      bindHoverBig('button');
      bindHoverBig('.btn');
      bindHoverBig('.folder-btn');

      if(('ontouchstart' in window) || navigator.maxTouchPoints > 0){
        cursor.style.display = 'none';
        document.body.style.cursor = 'auto';
      }
    })();

    (function(){
      const panels = document.querySelectorAll('.panel');
      const panelCount = panels.length;
      panels.forEach((panel, i) => {
        const index = i + 1;
        const angle = (360 / panelCount) * i;
        const hue = (360 / panelCount) * i;
        const left = 150 * i * -1;
        panel.style.setProperty('--angle', angle + 'deg');
        panel.style.setProperty('--hue', hue);
        panel.style.setProperty('--left', left + 'px');
      });
    })();
  </script>
  <script>
    (function(){
      function updateCarousel(){
        const root = document.documentElement;
        const panels = document.querySelectorAll('.panel');
        const panelCount = panels.length || 24;
        const vw = Math.max(window.innerWidth || 0, 320);
        const vh = Math.max(window.innerHeight || 0, 320);
        const portraitImg = document.querySelector('.portrait img');
        const imgH = portraitImg ? portraitImg.getBoundingClientRect().height : vh * 0.6;

        const radiusByWidth = vw * 0.55;
        const radiusByHeight = vh * 0.6;
        let radius = Math.max(240, Math.min(Math.max(radiusByWidth, radiusByHeight), 1400));

        const edgePadding = 24; 
        const panelWidth = 150; 
        const visibleWidth = 2 * radius + panelWidth;
        if(visibleWidth < vw - edgePadding) {
          radius = Math.max(radius, (vw - panelWidth - edgePadding) / 2);
        }

        const bottomPx = Math.round(vh * 0.15);

        root.style.setProperty('--carousel-radius', Math.round(radius) + 'px');
        root.style.setProperty('--carousel-bottom', bottomPx + 'px');
      }

      window.addEventListener('resize', updateCarousel);
      window.addEventListener('load', () => setTimeout(updateCarousel, 80));
      if (document.fonts && document.fonts.ready && typeof document.fonts.ready.then === 'function') {
        document.fonts.ready.then(updateCarousel);
      }
      updateCarousel();
    })();
  </script>
  <script>
    (function(){
      const GRID = {};
      const container = document.querySelector('.pixel-grid');
      if(!container) return;

      function buildGrid(cellSize = 12){
        while(container.firstChild) container.removeChild(container.firstChild);
        const vw = Math.max(window.innerWidth || 0, 320);
        const vh = Math.max(window.innerHeight || 0, 320);
        const cols = Math.ceil(vw / cellSize) + 1;
        const rows = Math.ceil(vh / cellSize) + 1;
        container.style.gridTemplateColumns = `repeat(${cols}, ${cellSize}px)`;
        container.style.gridTemplateRows = `repeat(${rows}, ${cellSize}px)`;
        container.style.pointerEvents = 'auto';

        const frag = document.createDocumentFragment();
        const total = cols * rows;
        for(let i=0;i<total;i++){
          const d = document.createElement('div');
          d.className = 'pixel';
          d.dataset.index = i;
          d.style.background = 'transparent';
          frag.appendChild(d);
        }
        container.appendChild(frag);

        GRID.cols = cols; GRID.rows = rows; GRID.cellSize = cellSize;
        GRID.container = container;
        GRID.elements = container.children;
      }

      GRID._buffer = [];
      GRID._flushScheduled = false;
      function _flushBuffer(){
        GRID._flushScheduled = false;
        if(!GRID._buffer || GRID._buffer.length === 0) { GRID._buffer.length = 0; return; }
        for(let i=0;i<GRID._buffer.length;i++){
          const item = GRID._buffer[i];
          const el = GRID.elements[item.idx];
          if(el) el.style.background = item.color || 'transparent';
        }
        GRID._buffer.length = 0;
      }
      function setPixel(x,y,color){
        if(!GRID.container) return false;
        if(x < 0 || y < 0 || x >= GRID.cols || y >= GRID.rows) return false;
        const idx = y * GRID.cols + x;
        GRID._buffer.push({ idx, color: color || 'transparent' });
        if(!GRID._flushScheduled){ GRID._flushScheduled = true; requestAnimationFrame(_flushBuffer); }
        return true;
      }

      function getPixel(x,y){
        if(!GRID.container) return null;
        if(x < 0 || y < 0 || x >= GRID.cols || y >= GRID.rows) return null;
        const idx = y * GRID.cols + x;
        const el = GRID.elements[idx];
        return el ? (el.style.background || null) : null;
      }

      function clearGrid(){
        if(!GRID.container) return;
        for(let i=0;i<GRID.elements.length;i++) GRID._buffer.push({ idx: i, color: 'transparent' });
        if(!GRID._flushScheduled){ GRID._flushScheduled = true; requestAnimationFrame(_flushBuffer); }
      }

      let paintColor = 'rgba(255,107,53,0.95)';
      container.addEventListener('pointerdown', (ev)=>{
        if(ev.button !== 0) return;
        const rect = container.getBoundingClientRect();
        const cx = Math.floor((ev.clientX - rect.left) / GRID.cellSize);
        const cy = Math.floor((ev.clientY - rect.top) / GRID.cellSize);
        setPixel(cx, cy, paintColor);
      });

      window.pixelGrid = {
        build: buildGrid,
        setPixel, getPixel, clear: clearGrid,
        GRID
      };

      function onResize(){
        const base = window.innerWidth > 1600 ? 14 : (window.innerWidth > 1000 ? 12 : 10);
        buildGrid(base);
      }
      window.addEventListener('resize', onResize);
      window.addEventListener('load', onResize);
      onResize();
    })();
  </script>
  <script>
    (function(){
      let simFiles = [];
      const api = { pixelGrid: window.pixelGrid, root: document.documentElement };
      let idx = 0;
      let currentStop = null;
      const runFor = 8000;

      async function loadSimList(){
        try{
          const listMod = await import('./Simulations/index.js');
          simFiles = listMod && listMod.default ? listMod.default : [];
        }catch(e){
          console.warn('failed loading Simulations index, falling back', e);
          simFiles = ['./Simulations/rain.js'];
        }
      }

      async function runNext(){
        if(!window.pixelGrid || !simFiles.length) return;
        if(currentStop) { try{ currentStop(); }catch(e){} currentStop = null; }
        const file = simFiles[idx % simFiles.length];
        idx++;
        try{
          const mod = await import(file);
          if(mod && typeof mod.default === 'function'){
            window.pixelGrid.clear();
            currentStop = mod.default(api) || null;
          }
        }catch(e){ console.warn('failed loading sim', file, e); }
        setTimeout(runNext, runFor);
      }

      async function tryStart(){
        await loadSimList();
        if(!simFiles.length) return;
        if(window.pixelGrid && window.pixelGrid.GRID){ runNext(); }
        else setTimeout(tryStart, 200);
      }
      tryStart();
    })();
  </script>
  <script>
    (function(){
      const banner = document.querySelector('.banner');
      if(!banner) return;
      let needsFallback = false;
      if(banner.getAnimations){
        try{ needsFallback = banner.getAnimations().length === 0; }catch(e){ needsFallback = false; }
      } else {
        const cs = getComputedStyle(banner);
        needsFallback = (cs.animationName === 'none' || cs.webkitAnimationName === 'none');
      }
      if(!needsFallback) return;
      let angle = 0;
      let last = performance.now();
      const period = 24000;
      const degPerMs = -360 / period;
      function tick(now){
        if(banner.dataset.lockAngle !== undefined){
          const locked = Number(banner.dataset.lockAngle) || 0;
          angle = locked;
          banner.style.webkitTransform = `rotateY(${angle}deg)`;
          banner.style.transform = `rotateY(${angle}deg)`;
          last = now;
          requestAnimationFrame(tick);
          return;
        }
        const dt = now - last;
        last = now;
        angle = (angle + degPerMs * dt) % 360;
        banner.style.webkitTransform = `rotateY(${angle}deg)`;
        banner.style.transform = `rotateY(${angle}deg)`;
        requestAnimationFrame(tick);
      }
      requestAnimationFrame(tick);
    })();
  </script>

</body>
</html>